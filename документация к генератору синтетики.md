# Документация

## Описание функции adjust_brightness_contrast
Функция adjust_brightness_contrast регулирует яркость и контрастность изображения.

### Параметры:
 - image: Входное изображение в формате NumPy массива (трёхканальное изображение).
 - brightness (по умолчанию = 0): Коэффициент изменения яркости изображения. Положительные значения увеличивают яркость, отрицательные — уменьшают.
 - contrast (по умолчанию = 0): Коэффициент изменения контрастности изображения. Положительные значения увеличивают контрастность, отрицательные — уменьшают.
  
### Возвращаемые значения:
 - img: Изображение с изменённой яркостью и контрастностью.
### Логика работы:
Регулировка яркости и контрастности:

Функция использует cv2.convertScaleAbs, которая применяется для изменения контрастности и яркости изображения.

alpha = contrast: Коэффициент контрастности. Увеличивает или уменьшает интенсивность пикселей в зависимости от их исходных значений.

beta = brightness: Коэффициент яркости. Добавляет или вычитает фиксированное значение к каждому пикселю.
### Примечания:

Значение контрастности может быть как положительным, так и отрицательным для увеличения или уменьшения контраста.

Изменение яркости осуществляется путем добавления константы ко всем пикселям.

## Описание функции apply_defect

Функция apply_defect накладывает дефект (например, повреждение пикселей) на изображение ноутбука и возвращает это изображение с дефектом, а также координаты ограничивающей рамки (bounding box) в формате YOLO.

### Параметры:
 - laptop_image: Исходное изображение ноутбука в формате NumPy массива.
 - defect_image: Изображение дефекта, которое будет наложено на ноутбук.
 - mask: Маска, которая указывает область экрана ноутбука, где возможна генерация дефекта.
 - radius (по умолчанию = 20): Радиус дефекта, который определяет его размер.
 - brightness (по умолчанию = 0): Коэффициент изменения яркости дефекта.
 - contrast (по умолчанию = 1.0): Коэффициент изменения контрастности дефекта.

### Возвращаемые значения:
 - laptop_image: Изображение ноутбука с наложенным дефектом.
 - bbox: Ограничивающая рамка для YOLO в виде кортежа из четырех значений:
  
    - x центра (нормализованный)
    - y центра (нормализованный)
    - ширина (нормализованная)
    - высота (нормализованная)

### Логика работы:
1. Генерация случайной позиции: Функция ищет случайную точку внутри маски, чтобы выбрать место для наложения дефекта. Маска определяет область, где дефект может быть размещён (например, на экране ноутбука).

2. Создание маски для дефекта: Создаётся круглая маска с заданным радиусом для определения области, на которой будет размещен дефект.

3. Масштабирование и поворот дефекта: Изображение дефекта масштабируется до нужного размера (2 * radius) и поворачивается на случайный угол.

4. Вычитание черных областей: Черные пиксели дефекта игнорируются с помощью создания маски и удаления этих областей из основной маски.

5. Регулировка яркости и контрастности: Функция adjust_brightness_contrast применяется для изменения яркости и контрастности дефекта.

6. Наложение дефекта: Изображение дефекта накладывается на изображение ноутбука, используя альфа-канал для плавного наложения с учётом маски.

7. Создание и применение краевой маски: Создаются расширенная и сжатая версии маски для того, чтобы добавить размытие по краям наложенного дефекта и более естественно интегрировать его в изображение.

8. Вычисление Bounding Box: Координаты ограничивающей рамки (bounding box) вычисляются в нормализованном виде, подходящем для формата YOLO.

### Примечания:
 - Использование маски: Маска позволяет точно указать, где на изображении может быть наложен дефект, избегая случайных размещений на нецелевых участках.
 - Регулировка яркости и контрастности: Это может помочь более естественно вписать дефект в изображение, если исходное изображение и дефект имеют разные уровни яркости.


## Описание функции draw_dead_pixel

Функция draw_dead_pixel вставляет дефект в виде "битого пикселя" (небольшого квадрата случайного размера и цвета) на изображение ноутбука в пределах маски экрана, а также возвращает bounding box в формате YOLO.

### Параметры:
 - laptop_img: Изображение ноутбука, на которое будет наложен дефект.
 - mask_resized: Маска экрана, которая определяет область, где может быть размещен битый пиксель (значение 255 указывает на область экрана).
### Возвращаемые значения:
 - laptop_img: Изображение с наложенным битым пикселем.
 - bbox: Ограничивающая рамка (bounding box) для YOLO, которая содержит координаты в формате (центр X, центр Y, ширина, высота), нормализованные в диапазоне [0, 1].
### Логика работы:
1. Получение белых пикселей на маске: Функция получает все координаты пикселей, где значение маски равно 255 (это область экрана ноутбука).

2. Проверка наличия подходящих областей:Если в маске нет белых пикселей, функция выводит сообщение о том, что нет доступных областей для наложения дефекта, и возвращает исходное изображение без изменений.

3. Выбор случайных координат: Если белые пиксели найдены, выбираются случайные координаты из этой области, где будет нарисован битый пиксель.

4. Случайный размер и цвет пикселя: Для дефекта создается случайный квадрат размером от 2x2 до 10x10 пикселей.
Цвет пикселя выбирается случайным образом для каждого из каналов (R, G, B).

5. Наложение пикселя: Функция рисует прямоугольник с выбранным размером и цветом в случайной позиции на экране ноутбука.

6. Вычисление bounding box: После рисования пикселя вычисляется bounding box, который включает его координаты в нормализованном виде для формата YOLO (центр X, центр Y, ширина, высота), где значения нормализованы относительно размеров изображения.
### Примечания:
Маска экрана: Маска указывает допустимые области для добавления дефекта.

## Описание функции mask_magic

Функция mask_magic обрабатывает маску, расширяя и сжимая её для получения маски краёв, которая может быть использована для дальнейшей обработки изображений.

### Параметры:
 - mask: Входная бинарная маска, представляющая область интереса (например, экран ноутбука), где значение 255 соответствует интересующим пикселям, а 0 — фоновым.
 - ex (по умолчанию = (3, 3)): Размер ядра, используемого для расширения маски. Указывает на размеры соседних пикселей, которые будут добавлены вокруг каждого белого пикселя в маске.
 - er (по умолчанию = (3, 3)): Размер ядра, используемого для сжатия маски. Указывает на размеры соседних пикселей, которые будут удалены вокруг каждого белого пикселя в маске.
### Возвращаемые значения:
 - edge_mask: Маска краёв входной маски, полученная путём вычитания сжатой маски из расширенной. 

### Логика работы:
1. Расширение маски: Используется операция расширения (dilate), которая добавляет белые пиксели (255) вокруг существующих белых пикселей в маске. Это позволяет увеличить область интереса, что может помочь в дальнейшем обработке.

2. Сжатие маски: Применяется операция сжатия (erode), которая удаляет белые пиксели, уменьшая область интереса. Это помогает удалить мелкие шумы и объекты, которые не должны быть частью конечной маски.

3. Получение маски краёв: Возвращаемая маска краёв получается путём вычитания сжатой маски из расширенной, что выделяет границы объектов в маске, а также увеличивает плавность переходов на краях.
4. Примечания: Использование размеров ядер: Размеры ядер ex и er могут быть изменены в зависимости от желаемой степени расширения и сжатия. Более крупные ядра приведут к более заметным изменениям в маске.

## Описание функции пайплайна аугментации

Пайплайн аугментации включает в себя функции apply_defect и draw_dead_pixel, которые используются для случайного добавления дефектов и битых пикселей на изображения ноутбуков с использованием соответствующих масок. Это позволяет создавать разнообразные варианты изображений, что является важной частью обучения моделей в задачах компьютерного зрения.

### Общая логика пайплайна:

- Цикл с apply_defect:

    - Для каждой итерации цикла обрабатывается одно изображение и его соответствующая маска. В каждой функции используется маска для определения допустимых областей, где могут быть добавлены дефекты или битые пиксели.
    - Вставка дефектов (apply_defect): Функция apply_defect вызывается в зависимости от заданного количества дефектов (Случайное количество меньшее заданного значения), которые необходимо добавить на изображение.
    - Из маски допустимого положения дефекта вырезается область очередного дефекта.
    - Очередные изображение и его метки сохраняются

- Цикл с draw_dead_pixel:

    - Аналогично, функция draw_dead_pixel вызывается несколько раз для добавления случайных битых пикселей на изображение.
    - Из маски допустимого положения дефекта вырезается область очередного дефекта.
    - Очередные изображение и его метки сохраняются

### Применение пайплайна:
Пайплайн аугментации используется для увеличения объема данных для обучения моделей глубокого обучения. 
Это позволяет:
- лучшить обобщающую способность модели, так как она будет обучаться на большем количестве разнообразных данных.
- Симулировать различные условия и ситуации, которые могут возникнуть в реальных условиях эксплуатации ноутбуков.
- Повысить устойчивость модели к вариациям и шуму в данных.
### Примечания:
- Параметры количества добавляемых дефектов и битых пикселей могут быть настроены в зависимости от специфики задачи и требований к данным.
- Использование масок позволяет точно контролировать, где именно будут добавлены дефекты, что важно для поддержания реалистичности и целостности данных.